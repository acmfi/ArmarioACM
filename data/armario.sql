CREATE TABLE COMPRA(
       ID INTEGER PRIMARY KEY NOT NULL,
       SUBTOTAL	      REAL NOT NULL,
       FECHA_COMPRA   DATE,
       CONCEPTO	      TEXT
);

CREATE TABLE PRODUCTO(
       ID INTEGER PRIMARY KEY NOT NULL,
       NOMBRE TEXT NOT NULL,
       Unidades_por_producto INTEGER NOT NULL,
       PRECIO REAL
);

CREATE TABLE COMPRA_PRODUCTO(
       ID INTEGER PRIMARY KEY NOT NULL,
       ID_COMPRA INTEGER,
       ID_PRODUCTO INTEGER,
       UNIDADES INTEGER NOT NULL,
       PRECIO_COMPRA REAL NOT NULL,
       FOREIGN KEY(ID_COMPRA) REFERENCES COMPRA(ID),
       FOREIGN KEY(ID_PRODUCTO) REFERENCES PRODUCTO(ID)
);

CREATE TABLE VENTA(
       ID INTEGER PRIMARY KEY NOT NULL,
       FECHA DATE
);

CREATE TABLE VENTA_PRODUCTO(
       ID INTEGER PRIMARY KEY NOT NULL,
       CANTIDAD INTEGER DEFAULT 1,
       ID_VENTA INTEGER,
       ID_PRODUCTO INTEGER,
       FOREIGN KEY(ID_VENTA) REFERENCES VENTA(ID),       
       FOREIGN KEY(ID_PRODUCTO) REFERENCES PRODUCTO(ID)
);

-- Trigger para el hist√≥rico del precio del produto.
CREATE TRIGGER HISTORICO_PRECIOS AFTER UPDATE OF PRECIO ON PRODUCTO BEGIN INSERT

CREATE TABLE PRECIOS(
       ID INTEGER PRIMARY KEY NOT NULL,
       ID_PRODUCTO INTEGER,
       PRECIO_VENTA REAL,
       FECHA_INICIO DATE,
       FOREIGN KEY(ID_PRODUCTO) REFERENCES PRODUCTO(ID)
);
